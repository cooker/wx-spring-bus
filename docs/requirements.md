# 事件调度系统 - 需求文档

## 1. 项目概述

基于 **JDK 21**、**Spring Boot 3.x** 的事件调度系统，使用 **MongoDB** 存储事件数据，通过 **RabbitMQ** 解耦消息的发布与消费。系统需支持查看**事件发起方**与**事件调用链路**，便于排查与运维。

---

## 2. 技术栈

| 类别     | 技术选型        | 说明 |
|----------|-----------------|------|
| 运行时   | JDK 21          | LTS，虚拟线程等特性 |
| 框架     | Spring Boot 3.x | 主框架 |
| 存储     | MongoDB         | 事件、链路等持久化 |
| 消息     | RabbitMQ        | 事件发布/订阅、解耦 |
| 后端模块 | bus / man       | 见下文 |
| 前端     | Vue + UI UX Pro Max | man 管理端 |

---

## 3. 架构与模块

### 3.1 整体架构

- **bus**：事件总线——负责事件的**发布**、**消费**、**状态标记**（如已处理、失败等）。
- **man**：管理端后端——负责**事件管理**（查询、详情）、**消息重推**等运维能力。
- **man-vue**：管理端前端——对 man 的 REST API 提供 Web 管理界面。

### 3.2 开发规范

- 采用 **DDD（领域驱动设计）** 进行后端开发。
- 模块内按 DDD 分层：领域层、应用服务、基础设施（含 MongoDB、RabbitMQ 适配）。

---

## 4. 功能需求

### 4.1 bus 模块

| 功能       | 描述 |
|------------|------|
| 消息推送   | 将事件发布到 RabbitMQ，并可在 MongoDB 中记录事件元数据（发起方、时间、载荷等）。 |
| 消息消费   | 从 RabbitMQ 消费事件，执行业务逻辑，并更新事件状态。 |
| 消息标记   | 对事件进行状态标记（如：已发送、已消费、失败、待重试等），状态持久化到 MongoDB。 |

### 4.2 man 模块

| 功能       | 描述 |
|------------|------|
| 消息管理   | 事件列表、条件查询、详情查看；可查看**事件发起方**、**事件调用链路**等。 |
| 消息重推   | 对指定事件（如失败或待重试）触发重新投递到 RabbitMQ，便于重试与修复。 |

### 4.3 可观测性

- **事件发起方**：能标识并展示是谁/哪个服务/哪个操作触发了该事件。
- **事件调用链路**：能记录并展示事件的传递路径（发布 → 队列 → 消费者 → 下游等），便于追踪与排障。

---

## 5. 非功能需求（概要）

- **存储**：事件及链路数据存 MongoDB，结构需支持按发起方、时间、状态、链路等查询。
- **解耦**：业务与消息传输通过 RabbitMQ 解耦，bus 与 man 可独立部署、扩展。
- **可维护性**：代码按 DDD 与模块划分，便于后续扩展与交接。

---

## 6. 项目结构（规划）

```text
wx-spring-bus/
├── pom.xml                 # 父 POM（JDK 21, Spring Boot 3.x）
├── bus/                    # 事件总线模块
│   └── pom.xml
├── man/                    # 管理端后端模块
│   └── pom.xml
├── man-vue/                # 管理端前端（Vue）
│   └── ...
├── docs/
│   └── requirements.md     # 本文档
└── TODO.md
```

---

## 7. 后续设计产出（待确认后补充）

- ~~事件与链路的数据模型（MongoDB 文档结构）~~ → 见 [事件与存储设计说明](./event-and-storage-design.md)。
- RabbitMQ 交换机/队列命名与路由策略。
- bus / man 的 API 设计（如 man 的查询、重推接口）。
- 前端 man-vue 的页面与交互设计。

---

**文档版本**：v0.1  
**状态**：待确认后进入详细设计与开发阶段。
